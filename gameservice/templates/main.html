{% extends 'base.html' %}

{% load static %}
{% block content %}
<div class="row">
    <h1>My Games</h1>
     <table class="table table-striped table-hover">
        <tr >
            <th>Title</th>
            <th>Developer</th> 
            <th>Categories</th>
            <th>Play</th>
        </tr>
        {% for game in mygames %}
            <tr >
            <td>{{ game.game.title }}</td> 
            <td>{{ game.game.developer }}</td> 
            <td>{{game.game.categories.all|join:", "}}</td>
            <td>
                <a href="{% url 'game' game.pk %}"><button>Play</button></a>
            </td>
            </tr>
        {% endfor %}
    </table>
</div>
<div class="row">
    <div class="search-options">
        <h1>Search games</h1>
        <form type="get" action=".">
            <input  id="search" type="text" name="search" value="{{query}}" placeholder="Search..." >
            <select id="categories" name="categories[]" multiple="multiple">
                {% for category in categories %}
                <option value="{{category}}">{{category}}</option>
                    {% endfor %}
            
            </select>
            <button id="search_submit" type="submit" >Submit</button>
        </form>
    </div>
</div>

<div class="row mt-4">

        {% if searched %}
            {% if results %}
                <table class="table table-striped table-hover">
                <tr >
                    <th>Title</th>
                    <th>Developer</th> 
                    <th>Price</th>
                    <th>Categories</th>
                    <th>Purchase</th>
                </tr>
                {% for game in results %}
                    <tr>
                    <td>{{ game.title }}</td> 
                    <td>{{ game.developer }}</td> 
                    <td>{{ game.price }} â‚¬</td>
                    <td>{{game.categories.all|join:", "}}</td>
                    <td>
                    {% if game.owned %}
                    Already owned
                    {% else %}
                    <button onclick="purchaseTitle(event, {{game.pk}})">Purchase</td>
                    {% endif %}
                    </tr>
                {% endfor %}
                </table>
            {% else %}
            <p> No results</p>
            {% endif %}
        {% endif %}
</div>
<script type="text/javascript" src="{% static 'js/bootstrap-multiselect.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/bootstrap-multiselect.css' %}" type="text/css"/>
<script src="{% static 'js/main.js' %}"></script>
<script type="text/javascript">
    $(document).ready(function() {
        var values = {{selected_categories|safe}}
        $('#categories').multiselect({
            nonSelectedText: 'Filter by category',
            buttonWidth: "200px",
        }).multiselect('select', values);
    });    
    var purchaseTitle = function (event, pk) {
        alert("Should purchase game with id " + pk)
        event.stopPropagation()
    }
    
</script>
{% endblock %}

    
